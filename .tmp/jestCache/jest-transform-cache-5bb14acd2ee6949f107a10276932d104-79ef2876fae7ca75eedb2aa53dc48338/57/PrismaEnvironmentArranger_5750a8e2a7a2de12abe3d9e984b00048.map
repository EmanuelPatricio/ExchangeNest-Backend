{"file":"C:\\Users\\epatr\\projects\\ExchangeNest-Backend\\tests\\Contexts\\Shared\\infrastructure\\prisma\\PrismaEnvironmentArranger.ts","mappings":";;;;;;;;;;;;AACA,yEAAsE;AAEtE,MAAa,yBAA0B,SAAQ,yCAAmB;IAChE,YAAoB,OAA8B;QAChD,KAAK,EAAE,CAAC;QADU,YAAO,GAAP,OAAO,CAAuB;IAElD,CAAC;IAEY,OAAO;;YAClB,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;QAC7B,CAAC;KAAA;IAEe,aAAa;;YAC3B,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC;YAEnC,MAAM,UAAU,GAAG,MAAM,MAAM,CAAC,SAAS,CAAU;;;;sFAI+B,CAAA;YAElF,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE;gBAClC,MAAM,MAAM,CAAC,SAAS,CAAA,kBAAkB,SAAS,EAAE,CAAA;aACpD;QACH,CAAC;KAAA;IAES,MAAM;QACd,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAEY,KAAK;;YAChB,OAAO,CAAC,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;QAC7C,CAAC;KAAA;CACF;AA9BD,8DA8BC","names":[],"sources":["C:\\Users\\epatr\\projects\\ExchangeNest-Backend\\tests\\Contexts\\Shared\\infrastructure\\prisma\\PrismaEnvironmentArranger.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\nimport { EnvironmentArranger } from '../arranger/EnvironmentArranger';\r\n\r\nexport class PrismaEnvironmentArranger extends EnvironmentArranger {\r\n  constructor(private _client: Promise<PrismaClient>) {\r\n    super();\r\n  }\r\n\r\n  public async arrange(): Promise<void> {\r\n    await this.cleanDatabase();\r\n  }\r\n\r\n  protected async cleanDatabase(): Promise<void> {\r\n    const client = await this.client();\r\n\r\n    const tableNames = await client.$queryRaw<string[]>`SELECT table_name\r\n                                                        FROM information_schema.tables\r\n                                                        WHERE table_schema='public'\r\n                                                        AND table_type='BASE TABLE'\r\n                                                        AND table_name NOT LIKE '\\_%'`\r\n\r\n    for (const tableName of tableNames) {\r\n      await client.$queryRaw`TRUNCATE TABLE ${tableName}`\r\n    }\r\n  }\r\n\r\n  protected client(): Promise<PrismaClient> {\r\n    return this._client;\r\n  }\r\n\r\n  public async close(): Promise<void> {\r\n    return (await this.client()).$disconnect();\r\n  }\r\n}"],"version":3}