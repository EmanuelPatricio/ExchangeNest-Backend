ae5ddd236e6e26c1ebff57007d816e57
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MongoEnvironmentArranger = void 0;
const EnvironmentArranger_1 = require("../arranger/EnvironmentArranger");
class MongoEnvironmentArranger extends EnvironmentArranger_1.EnvironmentArranger {
    constructor(_client) {
        super();
        this._client = _client;
    }
    arrange() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.cleanDatabase();
        });
    }
    cleanDatabase() {
        return __awaiter(this, void 0, void 0, function* () {
            const collections = yield this.collections();
            const client = yield this.client();
            for (const collection of collections) {
                yield client.db().collection(collection).deleteMany({});
            }
        });
    }
    collections() {
        return __awaiter(this, void 0, void 0, function* () {
            const client = yield this.client();
            const collections = yield client.db().listCollections(undefined, { nameOnly: true }).toArray();
            return collections.map(collection => collection.name);
        });
    }
    client() {
        return this._client;
    }
    close() {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.client()).close();
        });
    }
}
exports.MongoEnvironmentArranger = MongoEnvironmentArranger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxlcGF0clxccHJvamVjdHNcXEV4Y2hhbmdlTmVzdC1CYWNrZW5kXFx0ZXN0c1xcQ29udGV4dHNcXFNoYXJlZFxcaW5mcmFzdHJ1Y3R1cmVcXG1vbmdvXFxNb25nb0Vudmlyb25tZW50QXJyYW5nZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQ0EseUVBQXNFO0FBRXRFLE1BQWEsd0JBQXlCLFNBQVEseUNBQW1CO0lBQy9ELFlBQW9CLE9BQTZCO1FBQy9DLEtBQUssRUFBRSxDQUFDO1FBRFUsWUFBTyxHQUFQLE9BQU8sQ0FBc0I7SUFFakQsQ0FBQztJQUVZLE9BQU87O1lBQ2xCLE1BQU0sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdCLENBQUM7S0FBQTtJQUVlLGFBQWE7O1lBQzNCLE1BQU0sV0FBVyxHQUFHLE1BQU0sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdDLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBRW5DLEtBQUssTUFBTSxVQUFVLElBQUksV0FBVyxFQUFFO2dCQUNwQyxNQUFNLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQ3pEO1FBQ0gsQ0FBQztLQUFBO0lBRWEsV0FBVzs7WUFDdkIsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDbkMsTUFBTSxXQUFXLEdBQUcsTUFBTSxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLFNBQVMsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBRS9GLE9BQU8sV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxDQUFDO0tBQUE7SUFFUyxNQUFNO1FBQ2QsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RCLENBQUM7SUFFWSxLQUFLOztZQUNoQixPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2QyxDQUFDO0tBQUE7Q0FDRjtBQWhDRCw0REFnQ0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxlcGF0clxccHJvamVjdHNcXEV4Y2hhbmdlTmVzdC1CYWNrZW5kXFx0ZXN0c1xcQ29udGV4dHNcXFNoYXJlZFxcaW5mcmFzdHJ1Y3R1cmVcXG1vbmdvXFxNb25nb0Vudmlyb25tZW50QXJyYW5nZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcclxuaW1wb3J0IHsgRW52aXJvbm1lbnRBcnJhbmdlciB9IGZyb20gJy4uL2FycmFuZ2VyL0Vudmlyb25tZW50QXJyYW5nZXInO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vbmdvRW52aXJvbm1lbnRBcnJhbmdlciBleHRlbmRzIEVudmlyb25tZW50QXJyYW5nZXIge1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2NsaWVudDogUHJvbWlzZTxNb25nb0NsaWVudD4pIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgYXJyYW5nZSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGF3YWl0IHRoaXMuY2xlYW5EYXRhYmFzZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGNsZWFuRGF0YWJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBjb2xsZWN0aW9ucyA9IGF3YWl0IHRoaXMuY29sbGVjdGlvbnMoKTtcclxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IHRoaXMuY2xpZW50KCk7XHJcblxyXG4gICAgZm9yIChjb25zdCBjb2xsZWN0aW9uIG9mIGNvbGxlY3Rpb25zKSB7XHJcbiAgICAgIGF3YWl0IGNsaWVudC5kYigpLmNvbGxlY3Rpb24oY29sbGVjdGlvbikuZGVsZXRlTWFueSh7fSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGNvbGxlY3Rpb25zKCk6IFByb21pc2U8c3RyaW5nW10+IHtcclxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IHRoaXMuY2xpZW50KCk7XHJcbiAgICBjb25zdCBjb2xsZWN0aW9ucyA9IGF3YWl0IGNsaWVudC5kYigpLmxpc3RDb2xsZWN0aW9ucyh1bmRlZmluZWQsIHsgbmFtZU9ubHk6IHRydWUgfSkudG9BcnJheSgpO1xyXG5cclxuICAgIHJldHVybiBjb2xsZWN0aW9ucy5tYXAoY29sbGVjdGlvbiA9PiBjb2xsZWN0aW9uLm5hbWUpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGNsaWVudCgpOiBQcm9taXNlPE1vbmdvQ2xpZW50PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fY2xpZW50O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLmNsaWVudCgpKS5jbG9zZSgpO1xyXG4gIH1cclxufSJdLCJ2ZXJzaW9uIjozfQ==